<!-- .github/copilot-instructions.md - guidance for AI coding agents working on Joker-Card -->
# Copilot instructions for Joker-Card (Unity + Mirror)

Short purpose: help an AI agent be productive quickly in this repository (Unity project using Mirror networking).

- Project type: Unity game project. Root contains `Joker-Card.slnx` and many `*.csproj` files generated by Unity.
- Main engine and networking: Mirror is vendored under `Assets/Mirror` and project code uses Mirror's API heavily.

Key places to look
- Network manager and flow: `Assets/Scripts/Network/NetworkManagerCustom.cs` (custom Host/Client lifecycle). Example methods: `CreateRoom()`, `JoinRoom(string ip)`, `CreateRoomAfterSceneLoad()` — prefer editing here for matchmaking logic.
- Player network model: `Assets/Scripts/Network/PlayerData.cs` (player state & SyncVars).
- Game logic: `Assets/Scripts/Game/GameManager.cs`, `Assets/Scripts/Cards/Deck.cs`, `Assets/Scripts/Cards/Scoring.cs`.
- UI: `Assets/Scripts/UI/MainMenu.cs`, `RoomUI.cs`, `GameUI.cs`.
- Mirror & transports: `Assets/Mirror/Transports/*` (telepathy, kcp, encryption). BouncyCastle plugin is present under `Assets/Mirror/Transports/Encryption/Plugins`.
- Documentation: `文档/` contains `SETUP_GUIDE.md`, `NETWORK_SETUP.md`, `QUICK_REFERENCE.md` — these should be used as authoritative project-specific instructions.

Project-specific conventions and patterns
- Networking: code uses Mirror attributes and patterns: `[SyncVar]`, `[Command]` (Cmd...), `[ClientRpc]`, `[Server]`. Follow existing naming: server RPCs often start with `Cmd`, client RPCs with `Rpc` or use Mirror names.
- Prefabs: Player prefab must have `NetworkIdentity` and `PlayerData`. The Player Prefab is referenced by `NetworkManagerCustom` (see `SETUP_GUIDE.md`).
- Transport fallback: `NetworkManagerCustom.Awake()` will auto-add a `TelepathyTransport` if no `Transport` component exists. If you need a different transport (KCP, Edgegap), add it in the scene Inspector — code prefers a manually added Transport.
- Persistence across scenes: `NetworkManagerCustom` uses `DontDestroyOnLoad`. Avoid creating multiple instances; use `NetworkManagerCustom.Instance`.

Build / run / test workflows (discoverable)
- Typical interactive dev: open the project in Unity Editor, open `MainMenu` scene and use the in-game UI to `Create Room` (calls `StartHost()`) or `Join Room` (calls `StartClient()`). Use Build Settings to ensure relevant scenes are listed: `MainMenu`, `CreateRoom`, `JoinRoom`, `GameScene`.
- Quick automated command examples (replace Unity path and version):
  - Open Unity Editor for the project (Windows PowerShell):
    ```powershell
    & 'C:\Program Files\Unity\Hub\Editor\<VERSION>\Editor\Unity.exe' -projectPath 'd:\Users\iceshadow\Documents\Joker-Card'
    ```
  - Batch build (example template — fill `<VERSION>` and output path):
    ```powershell
    & 'C:\Program Files\Unity\Hub\Editor\<VERSION>\Editor\Unity.exe' -projectPath 'd:\Users\iceshadow\Documents\Joker-Card' -quit -batchmode -buildWindowsPlayer 'd:\builds\JokerCard.exe'
    ```
- Code editing: open `Joker-Card.slnx` in Visual Studio/VS Code for C# editing; compilation happens inside Unity. Unit tests are not present in repo root — rely on Unity playmode testing.

Integration points & external deps
- Mirror (vendored): `Assets/Mirror` — do not rewrite core Mirror code unless necessary. Prefer extending game logic in `Assets/Scripts`.
- Edgegap: repository includes Edgegap-related transport and csproj build constants (see `Assets/Mirror/Transports/Edgegap/*` and csproj DefineConstants containing `EDGEGAP_PLUGIN_SERVERS`). If altering networking to use Edgegap, check `Assets/Mirror/Transports/Edgegap/README.md` for usage.
- Encryption: BouncyCastle plugin present; encryption transport exists under Mirror's transports—see `Assets/Mirror/Transports/Encryption`.

When editing networking code — practical rules
- Change `NetworkManagerCustom` when you intend to alter lifecycle, room creation, or host/client orchestration. Example safe edits: change how `CreateRoom()` reports IP to `RoomUI`, add validation before `StartHost()`.
- To change message contracts / SyncVars: update `PlayerData.cs` and any RPCs that serialize complex data. Mirror uses `NetworkIdentity` and generated serializers—after changing types, open Unity to let Mirror recompile and regenerate code.
- Scene & prefab changes: update `文档/SETUP_GUIDE.md` and verify Build Settings scenes. Ensure Player prefab still contains `NetworkIdentity` and `PlayerData`.

Debugging hints (concrete)
- Look for `Debug.Log` in `NetworkManagerCustom.cs` — the file contains explicit logs at host start/join/room creation. Use these as first checkpoints.
- Use Mirror's Network Manager HUD and Network Statistics (in Editor) to inspect connections/latency.
- Common gotchas listed in `文档/NETWORK_SETUP.md`: missing Transport component, firewall blocking, scene list in Build Settings, and `DontDestroyOnLoad` causing duplicate managers.

Where to update docs
- If you change networking flow, update `文档/NETWORK_SETUP.md` and `文档/SETUP_GUIDE.md` and add short example snippets near `NetworkManagerCustom.cs`.

If unsure, what to ask the human maintainer
- Which Unity Editor versions to target (fill `<VERSION>` in CLI templates).
- Preferred transport for deployment (Telepathy/KCP/Edgegap) and whether Edgegap credentials/config should be stored in repo.
- Any CI steps to run Unity in headless mode (if available).

End — ask for feedback: "Is there anything else you'd like me to call out or expand (CI, editor version, Edgegap credentials)?"
